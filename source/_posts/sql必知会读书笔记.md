sqtitle: sql必知会读书笔记
date: 2019-07-24 11:53:46
tags: sql
categories: 数据库

1. sql是什么

   SQL （发音为字母 S-Q-L 或 sequel ）是结构化查询语言（ Structured Query Language ）的缩写。 SQL 是一种专门用来与数据库沟通的语言。

2. 为什么

   设计 SQL 的目的是很好地完成一项任务 —— **提供一种从数据库中读写数据的简单有效的方法。**
   
   标准 SQL 由 ANSI 标准委员会管理，从而称为 ANSI SQL 。


# 1. 数据库基础
## 概念：
1. 数据库（database）
保存有组织的数据的容器
2. 表（table）
表是一种结构化的文件，可用来存储某种特定类型的数据。
3. 模式（schema）
关于数据库和表的布局及特性的信息。这些特性定义了数据在表中如何存储，包含存储什么样的数据，数据如何分解，各部分信息如何命名等信息。
4. 列（ column ）
表中的一个字段。所有表都是由一个或多个列组成的。
5. 数据类型
所允许的数据的类型。每个表列都有相应的数据类型，它限制（或允许）该列中存储的数据。

**注意：数据类型兼容**
数据类型及其名称是 SQL 不兼容的一个主要原因。虽然大多数基本数据类型得到了一致的支持，但许多高级的数据类型却没有。更糟的是，
偶然会有相同的数据类型在不同的 DBMS 中具有不同的名称。

6. 行（row）

   表中的一个记录。表中的数据是按行存储的，所保存的每个记录存储在自己的行内。

7. 主键（ primary key ）
	一列（或一组列），其值能够唯一标识表中每一行。

	**主键的条件：**

   > 1. 任意两行都不具有相同的主键值；
   > 2. 每一行都必须具有一个主键值（主键列不允许NULL值）；
   > 3. 主键列中的值不允许修改或更新；
   > 4. 主键值不能重用（如果某行从表中删除，它的主键不能赋给以后的新行）。

   

# 2. 检索数据

提示：

>1. **结束 SQL 语句**。多条 SQL 语句必须以分号（；）分隔。多数 DBMS 不需要在单条 SQL 语句后加分号。
>
>2. **SQL 语句不区分大小写**，因此SELECT与select是相同的。
>
>3. **使用空格**。在处理 SQL 语句时，其中所有空格都被忽略。
>4. **当心逗号**。在选择多个列时，一定要在列名之间加上逗号，但最后一个列名后不加。如果在最后一个列名后加了逗号，将出现错误

注释：

单行：“#” 开头

多行：/*      */



#  3. 排序检索数据

**ORDER BY 子句的位置**
在指定一条ORDER BY子句时，应该保证它是SELECT语句中**最后一条子句**。如果它不是最后的子句，将会出现错误消息

##   按多个列排序

下面的代码检索 3 个列，并按其中两个列对结果进行排序 —— 首先按价格，然后按名称排序。

```sql
SELECT prod_id, prod_price, prod_name
FROM Products
ORDER BY prod_price, prod_name;
```

 ## 按列位置排序

```sql
SELECT prod_id, prod_price, prod_name
FROM Products
ORDER BY 2, 3;
```

ORDER BY 2，3表示先按prod_price，再按prod_name进行排序。

## 指定排序方向

DESC

DESC关键字只应用到直接位于其前面的列名。

警告：在多个列上降序排序
如果想在多个列上进行降序排序，必须对每一列指定DESC关键字。

# 4. 过滤数据

##  WHERE 子句

在SELECT语句中，数据根据WHERE子句中指定的搜索条件进行过滤。WHERE子句在表名（FROM子句）之后给出，



警告： WHERE 子句的位置
在同时使用ORDER BY和WHERE子句时，应该让ORDER BY位于WHERE之后，否则将会产生错误



##  WHERE 子句操作符

| 操作符  | 说 明              |
| ------- | ------------------ |
| BETWEEN | 在指定的两个值之间 |
| IS NULL | 为 NULL 值         |
| < >     | 不等于             |



```sql
SELECT prod_name, prod_price
FROM Products
WHERE (vend_id = 'DLL01' OR vend_id = ‘BRS01’)
AND prod_price >= 10;
```

这条SELECT语句与前一条的唯一差别是，将前两个条件用圆括号括了起来。因为圆括号具有比AND或OR操作符更高的求值顺序，所以 DBMS 首先
过滤圆括号内的OR条件。这时， SQL 语句变成了选择由供应商DLL01或BRS01制造的且价格在 10 美元及以上的所有产品，这正是我们希望的结
果。
### 复杂查询

提示:在WHERE子句中使用圆括号
任何时候使用具有AND和OR操作符的WHERE子句，都应该使用圆括号明确地分组操作符。

### IN操作符

为什么要使用IN操作符?其优点为: 

在有很多合法选项时，IN操作符的语法更清楚，更直观。 在与其他AND和OR操作符组合使用IN时，求值顺序更容易管理。 IN操作符一般比一组OR操作符执行得更快(在上面这个合法选项很少的例子中，你看不出性能差异)。 IN的最大优点是可以包含其他SELECT语句，能够更动态地建立WHERE子句。 

### NOT操作符

# 5. 用通配符进行过滤

##  LIKE操作符

### 百分号(%)通配符

最常使用的通配符是百分号(%)。在搜索串中，%表示任何字符出现任意次数。

**说明:区分大小写**
根据DBMS的不同及其配置，搜索可以是区分大小写的。如果区分大小写，则'fish%'与Fish bean bag toy就不匹配。

**警告:请注意NULL**
通配符%看起来像是可以匹配任何东西，但有个例外，这就是NULL。子句WHERE prod_name LIKE '%'不会匹配产品名称为NULL的行。

### 下划线(_)通配符

另一个有用的通配符是下划线(_)。下划线的用途与%一样，但它只匹配单个字符，而不是多个字符。

说明:DB2通配符 DB2不支持通配符_。 _

_说明:Access通配符
 如果使用的是Microsoft Access，需要使用?而不是_。 

### 方括号([ ])通配符

方括号 ([]) 通配符用来指定一个字符集，它必须匹配指定位置(通配符的位置)的一个字符。

## 使用通配符的技巧

- 不要过度使用通配符。如果其他操作符能达到相同的目的，应该使用其他操作符。

- 在确实需要使用通配符时，也尽量不要把它们用在搜索模式的开始处。把通配符置于开始处，搜索起来是最慢的。

- 仔细注意通配符的位置。如果放错地方，可能不会返回想要的数据。

    

# 7.计算字段

 CustomersCustomers

## 拼接字段

## 执行算数计算

加减乘除（+	-	*	/）



#  8. 使用数据处理函数

**DBMS 函数的差异**

| 函　 数              | 语　　法                                                     |
| :------------------- | ------------------------------------------------------------ |
| 提取字符串的组成部分 | Access 使用 MID() ； DB2 、 Oracle 、 PostgreSQL 和 SQLite 使用 SUBSTR() ； MySQL 和 SQL Server 使用 SUBSTRING() |
| 数据类型转换         | Access 和 Oracle 使用多个函数，每种类型的转换有一个函数； DB2 和 PostgreSQL 使用 CAST() ； MariaDB 、 MySQL 和 SQL Server 使用<br/>CONVERT() |
| 取当前日期           | Access 使用 NOW() ； DB2 和 PostgreSQL 使用 CURRENT_DATE ； MariaDB 和 MySQL 使用 CURDATE() ； Oracle 使用 SYSDATE ； SQL Server<br/>使用 GETDATE() ； SQLite 使用 DATE() |

##   常用的文本处理函数

| 函　　数                                   | 说　　明                |
| ------------------------------------------ | ----------------------- |
| LEFT() （或使用子字符串函数）              | 返回字符串左边的字符    |
| LENGTH() （也使用 DATALENGTH() 或 LEN() ） | 返回字符串的长度        |
| LOWER() （ Access 使用 LCASE() ）          | 将字符串转换为小写      |
| LTRIM()                                    | 去掉字符串左边的空格    |
| RIGHT() （或使用子字符串函数）             | 返回字符串右边的字符    |
| RTRIM()                                    | 去掉字符串右边的空格    |
| SOUNDEX()                                  | 返回字符串的 SOUNDEX 值 |
| UPPER() （ Access 使用 UCASE() ）          | 将字符串转换为大写      |



##  数值处理函数

| 函　　数 | 说　　明           |
| -------- | ------------------ |
| ABS()    | 返回一个数的绝对值 |
| COS()    | 返回一个角度的余弦 |
| EXP()    | 返回一个数的指数值 |
| PI()     | 返回圆周率         |
| SIN()    | 返回一个角度的正弦 |
| SQRT()   | 返回一个数的平方根 |
| TAN()    | 返回一个角度的正切 |

# 9. 聚集函数

SQL 聚集函数

| 函　　数 | 说　　明           |
| -------- | ------------------ |
| AVG()    | 返回某列的平均值   |
| COUNT()  | 返回某列的行数     |
| MAX()    | 返回指定列的最大值 |
| MIN()    | 返回某列的最小值   |
| SUM()    | 返回某列值之和     |

## **AVG（）**

警告：只用于单个列 

**AVG()**只能用来确定特定数值列的平均值，而且列名必须作为函数参数给出。为了获得多个列的平均值，必须使用多个AVG()函数。

AVG()函数忽略列值为NULL的行。

## count

使用COUNT(*)对表中行的数目进行计数，不管表列中包含的是空值（NULL）还是非空值。 

使用COUNT(column)对特定列中具有值的行进行计数，忽略NULL值。

##  **MAX()**函数

提示：对非数值数据使用MAX() 

虽然MAX()一般用来找出最大的数值或日期值，但许多（并非所有）DBMS允许将它用来返回任意列中的最大值，包括返回文本列中的最大 值。在用于文本数据时，MAX()返回按该列排序后的最后一行。

说明：NULL值 

MAX()函数忽略列值为NULL的行。

##  **MIN()**函数

## **SUM()**函数

SUM()用来返回指定列值的和（总计）。

# 10. 分组数据

在使用GROUP BY子句前，需要知道一些重要的规定。 

- GROUP BY子句可以包含任意数目的列，因而可以对分组进行嵌套，更细致地进行数据分组。 

-  如果在GROUP BY子句中嵌套了分组，数据将在最后指定的分组上进行汇总。换句话说，在建立分组时，指定的所有列都一起计算（所以不能从个别的列取回数据）。 

- GROUP BY子句中列出的每一列都必须是检索列或有效的表达式（但不能是聚集函数）。如果在SELECT中使用表达式，则必须在GROUP BY子句中指定相同的表达式。不能使用别名。 

- 大多数SQL实现不允许GROUP BY列带有长度可变的数据类型（如文本或备注型字段）。 

- 除聚集计算语句外，SELECT语句中的每一列都必须在GROUP BY子句中给出。 

- 如果分组列中包含具有NULL值的行，则NULL将作为一个分组返回。如果列中有多行NULL值，它们将分为一组。 

- GROUP BY子句必须出现在WHERE子句之后，ORDER BY子句之前。 

##  过滤分组

HAVING和WHERE的差别 

WHERE在数据分组前进行过滤，HAVING在数据分组后进行过滤。这是一个重要的区别，WHERE排除的行不包括在分组 中。这可能会改变计算值，从而影响HAVING子句中基于这些值过滤掉的分组。

使用HAVING时应该结合GROUP BY子句，而WHERE子句用于标准的行级过滤。

## 分组和排序



# 关键字

| 关键字               | 作用                 | 附加说明 |
| -------------------- | -------------------- | ---- |
| SELECT         | 要返回的列或表达式 |      |
| FROM             | 从中检索数据的表 |      |
| WHERE | 指定搜索条件进行过滤（行级过滤） | 范围值检查：BETWEEN  xx AND xx<br/>指定条件范围：IN(xx, xx)<br/>否定其后条件：NOT |
| GROUP BY             | 分组                             | 组级过滤：HAVING                                             |
| ORDER BY             | 输出排序顺序                     | 降序：DESC （DESCENDING）<br/>升序（默认）：ASC（ASCENDING） |
|                      |                                  |                                                              |
| DISTINCT    distinct |                                  |      |
| IS NULL              | 非空检查             |      |
|AND 、OR|逻辑操作符||
|LIKE|||
|                      |                                  ||
|                      |                                  ||

1. **distinct**

   它指示数据库只返回不同的值。

   > eg：SELECT DISTINCT vend_id FROM Products;

   **警告：不能部分使用 DISTINCT**
   DISTINCT关键字作用于所有的列，不仅仅是跟在其后的那一列。例如，你指定SELECT DISTINCT vend_id, prod_price，除非指定的两列完
   全相同，否则所有的行都会被检索出来。

   

